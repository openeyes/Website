<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>OpenEyes</title>
	
	<!-- CSS -->
	<link rel="stylesheet" href="../../css/openeyes.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="styles.css" type="text/css" media="screen" />

    <!--   Javascript  -->	
	<script language="JavaScript" src="../../scripts/elements.js" type="text/javascript"></script>
    <script language="JavaScript" src="../../scripts/ED_Drawing.js" type="text/javascript"></script>
    <script language="JavaScript" src="../../scripts/ED_Glaucoma.js" type="text/javascript"></script>	
	
    <script type="text/javascript">
        
        // Variables assigned to each drawing on this page
        var drawingEdit;
        var drawingDisplay;
        var opticCup;
        var opticCupEdit;
		                                    
        // Runs on page load
        function init()
        {
            // Get reference to the drawingEdit canvas
            var canvasEdit = document.getElementById('canvasEdit');

            // Create a drawing
            drawingEdit = new ED.Drawing(canvasEdit, ED.eye.Right, 'RPS', true, 0, 0);
            
            // Preload any images
            drawingEdit.preLoadImagesFrom('../../graphics/');
            
            // Set focus to canvasEdit element
            canvasEdit.focus();
            
            // Wait for drawingEdit object to be ready before adding objects or drawingEdits
            drawingEdit.onLoaded = function()
            {
            	editCanvasInit();
            }
            
            // Display canvas
            var canvasDisplay = document.getElementById('canvasDisplay');
            
            // Create a drawing
            drawingDisplay = new ED.Drawing(canvasDisplay, ED.eye.Right, 'RPS', false);

            // Preload any images
            drawingDisplay.preLoadImagesFrom('../../graphics/');
            
            // Wait for drawingEdit object to be ready before adding objects or drawingEdits
            drawingDisplay.onLoaded = function()
            {
                opticCup = drawingDisplay.addDoodle('OpticCup');
                drawingDisplay.addDoodle('OpticDisk');
                opticCup.toggleMode();
                opticCup.setHandleProperties();
                opticCup.squiggleArray[0].pointsArray[0].x = -160;
                opticCup.squiggleArray[0].pointsArray[0].y = -160;
                opticCup.squiggleArray[0].pointsArray[7].x = -180;
                opticCup.squiggleArray[0].pointsArray[7].y = -140;
                                                
                //opticCup.rotation = Math.PI/6;
                var defect = drawingDisplay.addDoodle('NerveFibreDefect');
                defect.rotation = -Math.PI/3;
                defect.arc = Math.PI/4;
                drawingDisplay.deselectDoodles();
            }
		}
    
    	function editCanvasInit()
    	{
            opticCupEdit = drawingEdit.addDoodle('OpticCup');
	        drawingEdit.addDoodle('OpticDisk');
            drawingEdit.deselectDoodles();
    	}
    	
        // Clears edit drawing and resets template
        function resetEdit()
        {
        	drawingEdit.deleteAllDoodles();
        	//editCanvasInit();        
            drawingEdit.drawAllDoodles();
            
            // Clear text area
            document.getElementById('opticdisk').value = "";
        }
        
        function addToReport()
        {
        	// Get text from the drawingEdit and force into string type
			var text = drawingEdit.report();
		
			// Use a RegEx to remove final comma and space
			text = text.replace(/, +$/, '');
			
			// Get reference to report textarea
			var repText = document.getElementById('opticdisk');
			
			// ***TEMP***
			repText.value = "";
			
			// If text there already, make it lower case and add a comma before
			if (repText.value.length > 0)
			{
				text = ", " + text.toLowerCase();
			}

			// Add to existing text in text area
			repText.value += text;
		}
		
		function changeLevel(_value)
		{
			opticCupEdit.toggleMode();
			opticCupEdit.setHandleProperties();
			drawingEdit.repaint(); 
		}

    </script>

</head>

<body onload="init();">
<div id="screen" align="center">
	<div id="content">

		<!-- Logo -->
		<img id="logo" src="../../images/OpenEyes_logo.png" align="left" alt="OpenEyes - an open source electronic patient record" />
		
		<!-- Navigation bar -->
		<div id="main_nav">
			<ul>
				<li><a id="home" href="../../index.html">Home</a></li>
				<li><a id="news" href="../../news.html">News</a></li>
				<li><a id="screenshots" href="../../screenshots.html">Screenshots</a></li>
				<li><a id="documentation" href="../../documentation.html">Documentation</a></li>
				<li><a id="contributors" href="../../contributors.html">Contributors</a></li>
				<li><a id="development_selected" href="../../development.html">Development</a></li>
				<li><a id="contact" href="../../contact.html">Contact us</a></li>
			</ul>
		</div>
		
		<!-- Element Title and Description -->
		<h2>Optic disk</h2>
		<div class="section">
			<h4>Description:</h4>
			<p>This element allows drawing and recording of optic disk findings. The disk can be selected by clicking on the margin, and then rotated to indicate disk tilt. Dragging one of the handles will show peri-papillary atrophy.</p>
			
			<p>The optic cup can be sized by selecting it and dragging the top handle to set the approximate size. Clicking the 'Toggle mode' button will then show additional handles which can be moved to indicate fine detail in the cup, for example localised notches.</p>
			<p>Status: <b>Alpha</b></p>
		</div>

		<!-- Settings section 
		<div class="section" style="height:70px;" align="left">
			<h4>Settings:</h4>
			<table cellspacing="0" width="620" >
				<tbody>				
					<tr>
						<td align="left" width="60%"><p class="complable" >Level:</p></td>
						<td align="left" width="40%">
							<select style="width: auto; margin-top:5px;" onchange="changeLevel(this.value);">
								<option>Basic</option>
								<option>Expert</option>
							</select>
				        </td>
					</tr>
				</tbody>
			</table>
		</div> -->

		<!-- Edit mode section -->
		<div class="section" style="height:480px;" align="left">
			<h4>Edit mode:</h4>
						
			<!-- Right eye -->
			<div style ="width: 540px; float:left;">
			
				<p>Right optic disk:</p>
			
            	<!-- Doodle toolbar -->
				<div class="toolbar">
					<button class="imgbutton" class="imgbutton" disabled="true" id="moveToFrontRPS" title="Move to front" onclick="drawingEdit.moveToFront(); return false;" ><img src="../../graphics/moveToFront.gif"/></button>
	                <button class="imgbutton" disabled="true" id="moveToBackRPS" title="Move to back" onclick="drawingEdit.moveToBack(); return false;" ><img src="../../graphics/moveToBack.gif" /></button>
	                <button class="imgbutton" disabled="true" id="deleteDoodleRPS" title="Delete" onclick="drawingEdit.deleteDoodle(); return false;" ><img src="../../graphics/delete.gif" /></button>
	                <button class="imgbutton" disabled="true" id="lockRPS" title="Lock" onclick="drawingEdit.lock(); return false;" ><img src="../../graphics/lock.gif" /></button>
	                <button class="imgbutton" disabled="true" id="unlockRPS" title="Unlock" onclick="drawingEdit.unlock(); return false;" ><img src="../../graphics/unlock.gif" /></button>
	                <br />

                    <button class="imgbutton" title="Disk Haemorrhage" onclick="drawingEdit.addDoodle('DiskHaemorrhage'); return false;" ><img src="../../graphics/DiskHaemorrhage.gif" /></button>
                    <button class="imgbutton" title="Nerve fibre layer defect" onclick="drawingEdit.addDoodle('NerveFibreDefect'); return false;" ><img src="../../graphics/NerveFibreDefect.gif" /></button>
                    <button class="imgbutton" title="Papilloedema" onclick="drawingEdit.addDoodle('Papilloedema'); drawingEdit.deselectDoodles(); return false;" ><img src="../../graphics/Papilloedema.gif" /></button>
                    <button class="imgbutton" title="Acquired Pit of Optic Nerve" onclick="drawingEdit.addDoodle('OpticDiskPit'); return false;" ><img src="../../graphics/OpticDiskPit.gif" /></button>
                     <br />
   				</div>
   				
				<!-- Canvas -->
				<div style='float:left; width: 320px; height: 320px;'>
	            	<canvas id="canvasEdit" class="canvasEditclass" width="300" height="300" tabindex="1"></canvas><br />
				</div>
			
				<!-- Controls -->
				<div style='float:right; width: 220px;height: 320px;'>
					            
					<button class="actbutton" title="Extracts description and diagnosis from drawingEdit" onclick="addToReport(); return false;" >Report</button>
<!-- 				<button class="actbutton" title="Clear drawing and start again" onclick="resetEdit(); return false;" >Reset</button> -->
					<button class="actbutton" title="Toggle mode for optic cup" onclick="changeLevel(true); return false;" >Toggle mode</button>
	
					<p class="lable">Description:</p>
					<textarea style="width:220px; height: 120px;" id="opticdisk"></textarea>
				</div>
				   			
			</div>

			<!-- Left eye -->
			<div style ="width:540px; float:left;">
				<p>Left optic disk:</p>
			</div>
			
		<!-- End of Edit mode section -->
		</div>

		<!-- Display mode section -->
		<div class="section" style="height:270px;" align="left">
			<h4>Display mode:</h4>
			
			<!-- Right eye -->
			<div style ="width:540px; float:left;">
				<p>Right eye:</p>
				<div style="float:left; width: 220px; height: 220px;">
					<canvas id="canvasDisplay" class="canvasDisplyclass" width="200" height="200" tabindex="1"></canvas><br />
				</div>
				<div style="float:right; width: 320px; height: 220px;">
					<p>Cup/disk ratio: 0.7, nerve fibre layer defect at 10 o'clock</p>
				</div>
			</div>
			
			<!-- Left eye -->
			<div style ="width:540px; float:left;">
				<p>Left eye:</p>					
			</div>				

		<!-- End of Display mode section -->
		</div>	

		<!-- Steering Group -->			
		<div class="section" align="left">
			<h4>Steering Group:</h4>
			<p>Glaucoma</p>
		</div>
		
		<!-- Blank Line -->
		<div class="section">
		</div>

	</div>
</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26543772-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>
</html>
