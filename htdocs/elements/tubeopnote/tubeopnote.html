<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>OpenEyes</title>
	
	<!-- CSS -->
	<link rel="stylesheet" href="../../css/openeyes.css" type="text/css" media="screen" />
	<link rel="stylesheet" href="styles.css" type="text/css" media="screen" />

    <!--   Javascript  	-->
	<script language="JavaScript" src="../../scripts/elements.js" type="text/javascript"></script>
    <script language="JavaScript" src="../../scripts/ED_Drawing.js" type="text/javascript"></script>
    <script language="JavaScript" src="../../scripts/ED_General.js" type="text/javascript"></script>
    <script language="JavaScript" src="../../scripts/ED_AntSeg.js" type="text/javascript"></script>
    <script language="JavaScript" src="../../scripts/ED_Glaucoma.js" type="text/javascript"></script> 
    
    <script type="text/javascript">
            
        // Variables assigned to each drawingEdit on this page
        var drawingEdit;
        var drawingDisplay;
                            
        // Runs on page load
        function init()
        {
            // Get reference to canvas
            var canvas = document.getElementById('canvas');
            
            // Create blank drawing
            drawingEdit = new ED.Drawing(canvas, ED.eye.Right, 'RPS', true, 0, 0);
            
			// Set focus to canvas
            canvas.focus();
            
            // Display canvas
            var canvasDisplay = document.getElementById('canvasDisplay');
            drawingDisplay = new ED.Drawing(canvasDisplay, ED.eye.Right, 'RPS', false);
            drawingDisplay.addDoodle('Iris');
            drawingDisplay.addDoodle('Pupil');
            drawingDisplay.addDoodle('Baerveldt');
            drawingDisplay.addDoodle('Supramid');
            drawingDisplay.addDoodle('Vicryl');
            drawingDisplay.addDoodle('Patch');
            var dood = drawingDisplay.addDoodle('PI');
            dood.outerRadius = 260;
            
            drawingDisplay.deselectDoodles();
            
	         // Function to detect changes in parameters (eg from mouse dragging)
	        drawingEdit.parameterListener = function()
	        {
                // Get reference to form inputs
                var platePosition = document.getElementById('platePosition');
                var patchType = document.getElementById('patchType');
                var ligated = document.getElementById('ligated');
                
                // Check doodle of a plate classname is selected
                var dood = drawingEdit.selectedDoodle;
                if (dood != null)
                {
                	if (dood.className == 'Molteno' || dood.className == 'Baerveldt' || dood.className == 'Ahmed')
                	{
                		platePosition.value = dood.getParameter('platePosition');
                	}
                }
                
                // Alter setting of patch drop down appropriately
                if (drawingEdit.hasDoodleOfClass('Patch'))
                {
                	// May have been set to another material other than sclera
                	if (patchType.value == 'None')
                	{
                		patchType.value = 'Sclera';
                	}
                }
                else
                {
                	patchType.value = 'None'
                }
                
                // Alter setting of ligature drop down appropriately
                if (drawingEdit.hasDoodleOfClass('Vicryl'))
                {
                	// May have been set to another material other than vicryl
                	if (ligated.value == 'None')
                	{
                		ligated.value = 'Vicryl';
                	}
                }
                else
                {
                	ligated.value = 'None'
                }
	        }
                   
            // Template, scaled down since need more area around cornea to manipulate tube
            var doodle = drawingEdit.addDoodle('Iris');
            var doodle = drawingEdit.addDoodle('Pupil');
            
			// Don't leave it selected
            drawingEdit.deselectDoodles();
            
            // Draw doodles
            drawingEdit.drawAllDoodles();
        }
                  
       	function addToReport()
        {
        	// Get text from the applet and force into string type
			var text = drawingEdit.report();
		
			// Use a RegEx to remove final comma and space
			text = text.replace(/, +$/, '');
			
			// Get reference to report textarea
			var repText = document.getElementById('opnote');
			
			// ***TEMP***
			repText.value = "";
			
			// If text there already, make it lower case and add a comma before
			if (repText.value.length > 0)
			{
				text = ", " + text.toLowerCase();
			}

			// Add to existing text in text area
			repText.value += text;
		}
		
		// Handles change of value of Supramid checkbox
		function supramid(_checked)
		{
			var howFar = document.getElementById('howFar');
			var mm = document.getElementById('mm');
			
			if (!_checked)
			{
				howFar.style.display = "inline";
				mm.style.display = "inline";
				howFar.focus();
			}
			else
			{
				howFar.style.display = "none";
				howFar.style.display = "mm";
			}
		}
		
		function setPlateQuadrant(_value)
		{
			var plateDoodle = drawingEdit.firstDoodleOfClass('Molteno');
			if (plateDoodle) drawingEdit.setParameterForDoodleOfClass('Molteno', 'platePosition', _value);
			plateDoodle = drawingEdit.firstDoodleOfClass('Baerveldt');
			if (plateDoodle) drawingEdit.setParameterForDoodleOfClass('Baerveldt', 'platePosition', _value);
			plateDoodle = drawingEdit.firstDoodleOfClass('Ahmed');
			if (plateDoodle) drawingEdit.setParameterForDoodleOfClass('Ahmed', 'platePosition', _value);
		}
		
		// Called by select element to add or delete patch doodle
		function togglePatch(_value)
		{
			if (_value != 'None')
			{
				if (!drawingEdit.hasDoodleOfClass('Patch'))
				{
					drawingEdit.addDoodle('Patch');
				}
			}
			else
			{
				drawingEdit.deleteDoodlesOfClass('Patch');
			}
		}

		// Called by select element to add or delete patch doodle
		function toggleVicryl(_value)
		{
			if (_value != 'None')
			{
				if (!drawingEdit.hasDoodleOfClass('Vicryl'))
				{
					drawingEdit.addDoodle('Vicryl');
				}
			}
			else
			{
				drawingEdit.deleteDoodlesOfClass('Vicryl');
			}
		}
			            
    </script>

</head>
<body onload="init();">
<div id="screen" align="center">
	<div id="content">

		<!-- Logo -->
		<img id="logo" src="../../images/OpenEyes_logo.png" align="left" alt="OpenEyes - an open source electronic patient record" />
		
		<!-- Navigation bar -->
		<div id="main_nav">
			<ul>
				<li><a id="home" href="../../index.html">Home</a></li>
				<li><a id="news" href="../../news.html">News</a></li>
				<li><a id="screenshots" href="../../screenshots.html">Screenshots</a></li>
				<li><a id="documentation" href="../../documentation.html">Documentation</a></li>
				<li><a id="contributors" href="../../contributors.html">Contributors</a></li>
				<li><a id="development_selected" href="../../development.html">Development</a></li>
				<li><a id="contact" href="../../contact.html">Contact us</a></li>
			</ul>
		</div>
		
		<!-- Text -->
		<h2>Glaucoma tube operation note element</h2>

		<div class="section">
			<h4>Description:</h4>
			<p>This element facilitates the data input for an operation note for tube surgery. As with other elements, certain components of the diagram are linked to the text boxes in order to avoid duplicated data entry.</p>
			<p>Status: <b>Alpha</b></p>
		</div>

		<!-- Edit mode section -->
		<div class="section" style="height:525px;" align="left">
			<h4>Edit mode:</h4>
			
			<!-- Drawing -->
			<div style ="width:340px; float:left;">	
			
            	<!-- Doodle toolbar -->
				<div class="toolbar">
					<button class="imgbutton" class="imgbutton" disabled="true" id="moveToFrontRPS" title="Move to front" onclick="drawingEdit.moveToFront(); return false;" ><img src="../../graphics//moveToFront.gif"/></button>
	                <button class="imgbutton" disabled="true" id="moveToBackRPS" title="Move to back" onclick="drawingEdit.moveToBack(); return false;" ><img src="../../graphics//moveToBack.gif" /></button>
	                <button class="imgbutton" disabled="true" id="deleteDoodleRPS" title="Delete" onclick="drawingEdit.deleteDoodle(); return false;" ><img src="../../graphics/delete.gif" /></button>
                    <button class="imgbutton" disabled="true" id="flipVerRPS" title="Flip around vertical axis" onclick="drawingEdit.flipVer(); return false;" ><img src="../../graphics/flipVer.gif" /></button>
                    <button class="imgbutton" disabled="true" id="flipHorRPS" title="Flip around horizontal axis" onclick="drawingEdit.flipHor(); return false;" ><img src="../../graphics/flipHor.gif" /></button>
	                <button class="imgbutton" disabled="true" id="lockRPS" title="Lock" onclick="drawingEdit.lock(); return false;" ><img src="../../graphics//lock.gif" /></button>
	                <button class="imgbutton" disabled="true" id="unlockRPS" title="Unlock" onclick="drawingEdit.unlock(); return false;" ><img src="../../graphics//unlock.gif" /></button>
	                <br />
                    <button class="imgbutton" id="molteno" title="Molteno tube" onclick="drawingEdit.addDoodle('Molteno'); return false;" ><img src="../../graphics/Molteno.gif" /></button> 
                    <button class="imgbutton" id="baerveldt" title="Baerveldt tube" onclick="drawingEdit.addDoodle('Baerveldt'); return false;" ><img src="../../graphics/Baerveldt.gif" /></button> 
                    <button class="imgbutton" id="ahmed" title="Ahmed tube" onclick="drawingEdit.addDoodle('Ahmed'); return false;" ><img src="../../graphics/Ahmed.gif" /></button>                          
                    <button class="imgbutton" id="patch" title="Patch" onclick="drawingEdit.addDoodle('Patch'); return false;" ><img src="../../graphics/ScleralPatch.gif" /></button>
                    <button class="imgbutton" id="BlebRPS" title="Trabeculectomy bleb" onclick="var dood = drawingEdit.addDoodle('Bleb'); dood.baseRadius = 280; drawingEdit.repaint(); return false;" ><img src="../../graphics/Bleb.gif" /></button>
                    <button class="imgbutton" id="PIRPS" title="Peripheral Iridectomy" onclick="var dood = drawingEdit.addDoodle('PI'); dood.outerRadius = 260; drawingEdit.repaint(); return false;" ><img src="../../graphics/PI.gif" /></button>
					<button class="imgbutton" id="sidePortRPS" title="Vicryl suture" onclick="drawingEdit.addDoodle('Vicryl'); return false;" ><img src="../../graphics/Vicryl.gif" /></button>
					<button class="imgbutton" id="sidePortRPS" title="Supramid" onclick="drawingEdit.addDoodle('Supramid'); return false;" ><img src="../../graphics/Supramid.gif" /></button>                                 	                    
                </div>		

				<!-- Canvas -->
				<div style='float:left; width: 320px; height: 320px;'>
	                <canvas id="canvas" class="canvasclass" width="300" height="300" tabindex="1"></canvas>
				</div>
				
			</div>
			
			<!-- Controls -->
			<div style ="width:460px; float:left;">
			
					<table cellspacing="0" width="120" >
					<tbody>		
						<tr>
							<td align="left" width="20%"><p class="lable" >Plate position:</p></td>
							<td align="left" width="60%">
						        <select name="incision" id="platePosition" onclick="setPlateQuadrant(this.value);">
						            <option value="STQ">STQ</option>
						            <option value="SNQ">SNQ</option>
						            <option value="INQ">INQ</option>
						            <option value="ITQ">ITQ</option>
						        </select>
					        </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Plate-limbus:</p></td>
							<td align="left">
 								<input type="text" id="plateLimbusDistance" onchange="drawingEdit.setParameterForDoodleOfClass('Baerveldt', 'plateLimbusDistance', this.value);"/>&nbspmm
					        </td>
						</tr>			
						<tr>
							<td align="left"><p class="lable" >Tube position:</p></td>
							<td align="left">
						        <select>
						            <option>AC</option>
						            <option>Sulcus</option>
						            <option>Pars plana</option>
						        </select>
					        </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Antimetabolites:</p></td>
							<td align="left">
						        <select>
						            <option>None</option>
						            <option>MMC 0.2</option>
						            <option>MMC 0.4/0.5</option>
						        </select>
        					 </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Per-op drugs:</p></td>
							<td align="left">
						        <select>
						            <option>None</option>
						            <option>Periorbital</option>
						            <option>Intravitreal/Cameral</option>
						            <option>Systemic</option>
						        </select>
        					 </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Patch:</p></td>
							<td align="left">
						        <select id="patchType" onclick="togglePatch(this.value);" >
						            <option>None</option>
						            <option>Sclera</option>
						            <option>Cornea</option>
						            <option>Pericardium</option>
						            <option>Tenons</option>
						            <option>Scleral flap</option>
						        </select>
        					 </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Supramid:</p></td>
							<td align="left">
								<input class="checkbox" type="checkbox" checked="true" id="chk_sup" onchange="supramid(this.checked)";/>
								<input type="text" title="if not in the AC, how far from the limbus was it left?"style="display: none;" id="howFar"/><span id="mm" style="display: none;">&nbspmm</span>
					        </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Stent:</p></td>
							<td align="left">
								<input class="checkbox" type="checkbox" id="chk_ste"/>
					        </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Ligature:</p></td>
							<td align="left">
								<input class="checkbox" type="checkbox" id="chk_lig"/>
					        </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Ligated:</p></td>
							<td align="left">
						        <select id="ligated" onclick="toggleVicryl(this.value);" >
						            <option>None</option>
						            <option>10/0 Nylon</option>
						            <option>Vicryl</option>
						            <option>Prolene</option>
						        </select>
        					 </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Slit:</p></td>
							<td align="left">
								<input class="checkbox" type="checkbox" id="chk_sup"/>
					        </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Visco in AC:</p></td>
							<td align="left">
								<input class="checkbox" type="checkbox" id="chk_ste"/>
					        </td>
						</tr>
						<tr>
							<td align="left"><p class="lable" >Flow tested:</p></td>
							<td align="left">
								<input class="checkbox" type="checkbox" id="chk_ste"/>
					        </td>
						</tr>
						<tr>
							<td align="left">
								<button class="actbutton" style="width: 80px; float: right; margin-right: 10px;" title="Creates a written report of the operation" onclick="addToReport(); return false;" >Report</button>
							</td>
							<td align="left">
								<textarea name="opnote" id="opnote"></textarea>
							</td>
						</tr>
							
						</tbody>	
					</table>

			</div>
		
		<!-- End of edit mode div -->
		</div>						

		<!-- Display mode section -->
		<div class="section" style="height:270px;" align="left">
		
			<!-- Overall width -->
			<div style ="width:540; float:left;">
				<h4>Display mode:</h4>
				<div style="float:left; width: 220px; height: 220px;">
					<canvas class="display" id="canvasDisplay" width="200" height="200" tabindex="1"></canvas>
				</div>
				<div style="float:right; width: 320px; height: 220px;">
					<p>Baerveld tube in superotemporal quadrant, with supramid 7mm from limbus, and vicryl ligature, covered with scleral patch</p>
				</div>
			</div>
	
		</div>	

		<!-- Steering Group -->			
		<div class="section" align="left">
			<h4>Steering Group:</h4>
			<p>Glaucoma</p>
		</div>
		
		<!-- Blank Line -->
		<div class="section">
		</div>

	</div>
</div>

<script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-26543772-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>
</body>

</html>
